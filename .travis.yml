language: python
sudo: required

python:
  - "3.6"

install:
  # Install libiio
  - sudo apt-get -qq update
  - sudo apt-get install -y git cmake graphviz libaio-dev libavahi-client-dev libavahi-common-dev libusb-1.0-0-dev libxml2-dev rpm tar bzip2 gzip flex bison git
  - git clone -b 'v0.18' --single-branch --depth 1 https://github.com/analogdevicesinc/libiio.git
  - cd libiio
  - cmake .
  - make
  - sudo make install
  - cd ..
  # Install doc requirements
  - sudo pip install -r requirements.txt
  - sudo pip install -r requirements_doc.txt

script:
  - export PYTHONPATH=$PYTHONPATH:'/usr/lib/python3.6/site-packages'
  - python -m unittest

after_success:
  - export PYTHONPATH=$PYTHONPATH:'/usr/lib/python3.6/site-packages'
  - cd doc && make html

deploy:
  provider: pages
  verbose: true
  skip-cleanup: true
  keep-history: true
  on:
    branch: master
  github-token: $GITHUB_TOKEN
  local-dir: doc/build/html
  committer-from-gh: true
